import{noChange as S,nothing as M}from"lit";import{directive as V,Directive as k,PartType as F}from"lit/directive.js";import{_fromString as C,ArrayModel as f,BooleanModel as _,ObjectModel as b,getBinderNode as A,hasFromString as P}from"./Models.js";import{_validity as w,defaultValidity as v}from"./Validity.js";const B=["required","invalid","errorMessage","value","validity","checkValidity"];function j(t){return B.some(e=>e in t)}class g{model;_element;_validityFallback=v;constructor(e,n){this._element=e,this.model=n}get element(){return this._element}set element(e){this._element=e}get value(){return this.element.value}set value(e){this.element.value=e}set errorMessage(e){}get validity(){return this.element.validity??this._validityFallback}checkValidity(){if(!this.element.checkValidity)return!0;const e=this.element.checkValidity();return this._validityFallback={...v,valid:e,...e?{}:this._detectValidityError()},e}setAttribute(e,n){n?this.element.setAttribute(e,""):this.element.removeAttribute(e)}removeEventListeners(){}_detectValidityError(){if(!("inputElement"in this.element))return{customError:!0};const e=this.element.inputElement;return this.element.value===""?e.value===""?{valueMissing:!0}:{badInput:!0}:{customError:!0}}}class y extends g{_invalid=!1;_boundOnValidated=this._onValidated.bind(this);constructor(e,n){super(e,n),e.addEventListener("validated",this._boundOnValidated)}set required(e){this.element.required=e}set invalid(e){this._invalid=e,this.element.invalid=e}set errorMessage(e){this.element.errorMessage=e}removeEventListeners(){this.element.removeEventListener("validated",this._boundOnValidated)}_onValidated(e){if(!(e instanceof CustomEvent)||typeof e.detail!="object")return;const n=!e.detail.valid;this._invalid!==n&&(this.element.invalid=this._invalid)}}class s extends g{set required(e){this.setAttribute("required",e)}set invalid(e){this.setAttribute("invalid",e)}}class p extends s{get value(){return this.model instanceof _?this.element.checked:this.element.checked?this.element.value:void 0}set value(e){this.element.checked=/^(true|on)$/iu.test(String(e))}}class L extends y{get value(){if(this.model&&(this.model instanceof b||this.model instanceof f)){const{selectedItem:e}=this.element;return e===null?void 0:e}return super.value}set value(e){this.model instanceof b||this.model instanceof f?this.element.selectedItem=e===void 0?null:e:super.value=e}}class q extends y{get value(){return this.element.selectedItems}set value(e){this.element.selectedItems=e}}class N extends s{get value(){return this.element.selected}set value(e){this.element.selected=e}}function $(t,e){switch(t.localName){case"vaadin-checkbox":case"vaadin-radio-button":return new p(t,e);case"vaadin-combo-box":return new L(t,e);case"vaadin-list-box":return new N(t,e);case"vaadin-multi-select-combo-box":return new q(t,e);case"vaadin-rich-text-editor":return new s(t,e);default:return t.localName==="input"&&/^(checkbox|radio)$/u.test(t.type)?new p(t,e):t.constructor.version?new y(t,e):new s(t,e)}}function x(t,e){return typeof e=="string"&&P(t)?t[C](e):e}const G=V(class extends k{fieldState;constructor(t){if(super(t),t.type!==F.PROPERTY&&t.type!==F.ELEMENT)throw new Error('Use as "<element {field(...)}" or <element ...={field(...)}"')}render(t,e){return M}update(t,[e,n]){const r=t.element,l=A(e);if(!this.fieldState){const a={errorMessage:"",name:"",value:"",required:!1,invalid:!1,model:e,validity:v,element:r,strategy:l.binder.getFieldStrategy(r,e)};this.fieldState=a;const T=()=>{a.strategy.checkValidity(),a.strategy.validity.badInput||(a.value=a.strategy.value),a.validity=a.strategy.validity,l[w]=a.validity,l.value=x(e,a.value),n!==void 0&&n.call(r,r)};r.addEventListener("input",T);const h=()=>{T(),l.visited=!0};r.addEventListener("blur",h),r.addEventListener("change",h)}const{fieldState:i}=this;(i.element!==r||i.model!==e)&&(i.strategy=l.binder.getFieldStrategy(r,e));const{name:o}=l;o!==i.name&&(i.name=o,r.setAttribute("name",o));const{value:d}=l,E=x(e,i.value);d!==E&&!(Number.isNaN(d)&&Number.isNaN(E))&&(i.value=d,i.strategy.value=d);const{required:u}=l;u!==i.required&&(i.required=u,i.strategy.required=u);const c=l.ownErrors[0]?.message||"";c!==i.errorMessage&&(i.errorMessage=c,i.strategy.errorMessage=c);const{invalid:m}=l;return m!==i.invalid&&(i.invalid=m,i.strategy.invalid=m),S}});export{g as AbstractFieldStrategy,p as CheckedFieldStrategy,L as ComboBoxFieldStrategy,s as GenericFieldStrategy,q as MultiSelectComboBoxFieldStrategy,N as SelectedFieldStrategy,y as VaadinFieldStrategy,G as field,$ as getDefaultFieldStrategy,j as isFieldElement};
//# sourceMappingURL=Field.js.map
